<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Block access to sensitive files and directories BEFORE redirecting
    RewriteRule ^\.env - [F,L]
    RewriteRule ^\.git - [F,L]
    RewriteRule ^vendor/ - [F,L]
    RewriteRule ^storage/ - [F,L]
    RewriteRule ^bootstrap/ - [F,L]
    RewriteRule ^config/ - [F,L]
    RewriteRule ^database/ - [F,L]
    RewriteRule ^routes/ - [F,L]
    RewriteRule ^tests/ - [F,L]
    RewriteRule ^app/ - [F,L]
    RewriteRule ^composer\.(json|lock)$ - [F,L]
    RewriteRule ^artisan$ - [F,L]
    RewriteRule ^phpunit\.xml$ - [F,L]
    RewriteRule ^server\.php$ - [F,L]
    RewriteRule ^package(-lock)?\.json$ - [F,L]
    RewriteRule ^webpack\.mix\.js$ - [F,L]
    
    # Redirect everything else to public folder
    RewriteCond %{REQUEST_URI} !^/public/
    RewriteRule ^(.*)$ public/$1 [L]
</IfModule>

# Additional file-level protection
<FilesMatch "^(\.env|\.git.*|composer\.(json|lock)|artisan|server\.php|phpunit\.xml|package.*\.json|webpack\.mix\.js)$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order allow,deny
        Deny from all
    </IfModule>
</FilesMatch>

# Disable directory browsing
Options -Indexes

# Prevent access to PHP files in certain directories
<FilesMatch "\.php$">
    <If "%{REQUEST_URI} =~ m#^/(storage|bootstrap|config|database|routes|tests)/#">
        <IfModule mod_authz_core.c>
            Require all denied
        </IfModule>
    </If>
</FilesMatch>